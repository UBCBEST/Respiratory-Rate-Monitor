# resp-rate

## Pediatric Respiration Rate Monitor project for UBC BEST. 
Project Status: Closed, Deprecated.

## Folders
**Legacy** - Pre-2018 implementation of the project, employed one accelerometer placed on thorax to infer breathing. No longer supported.

**rrm_2018/2019** - Updated implementation, uses two accelerometers oriented on the same transverse plane anterior and posterior to the thorax along the midline. Precise placement indeterminate. 
Principle of operation is that by having two accelerometers, any additional movement (rotation, running etc.) would be equalized and cancelled out. 
Please refer to the following paper "Measuring Respiration and Heart Rate using Two Acceleration Sensors on a Fully Embedded Platform" by
J. Vertens et. al for the detailed explanation.

## Source Code
**Arduino:** Handles reading of sensors and transmission of serial data

* LSM9DS1.I2C_TEST.ino - Configures the front and back sensors, which collects data in the form of acceleration, magnetometer and 
gyroscope data. Formats data and sends over serial to the connected host device at a frequency set by the Timer1 ISR.

* SparkFun_LSM9DS1_Arduino_Library-master/ - contains the library files required and additional examples

**C++**: Visual Studio project that expands on the base Serial class provided to parse (and hence can be extended and used for the user's application) and display the data received serially.
Should work on at least VisualStudio 2015 and newer. 
* main.cpp - creates the Serial class object and assigns it the com port to the serial device, calls Serial parsing functions in a loop. Code to open and link to an instance of Matlab commented out (additional changes to environment variables needed to get this up and running)
* SerialPort.cpp/h - Extension of the serial class, constructor connects to the serial port, destructor disconnects. Contains default functions ReadData(),
WriteData, IsConnected. Function ParseRead() added to take the formatted serial transmission string and extracts the relevant data and uses the 
AccelData class that later formats and stores it; ParseRead() additionally will echo the serial transmission to a terminal window/monitor for validation.
* AccelData.cpp/h - Takes the parsed data from ParseRead() and stores it into an array of doubles (should be changed to a vector), and checks if the data is 
well formed. 

**Matlab:** Extends the open source IMU and AHRS algorithms provided by Sebastian Madgwick (http://x-io.co.uk/open-source-imu-and-ahrs-algorithms) to parse, 
process and visualize serial data.

* @MadgwickAHRS/, @MahonyAHRS, @quarternion_library - contains libraries and source code for the IMU and AHRS algorithms. 
* read_serial.m - Not particularly useful, tests that at least one point of data can be plotted in real time
* TwoSensorMadgwick.m - Captures sensor data over a fixed period of time then will plot the correspond accelerometer, gyroscope and magnetometer data 
over that capture time and additionally calculates and plots the Euler angles describing the orientation of the accelerometers in space
* serial_parse.m - TwoSensorMadgwick.m but continuous and in pseudo-real time (some significant and uncharacterised lag between readings and their visualizations)
Note: Euler angle data requires some 'ramp-up' time before accurately displaying their values.

**Processing:** Used to visualize the two sensors in 3D space

* Visualizer.pde - takes file containing the Euler angle data (for example generated by TwoSensorMadgwick.m or serial_parse.m) and creates two 
3D objects representing the sensors and visualizes their movement in space

All source code more or less can be deployed immediately after cloning the repository provided the Arduino file and hardware is configured accordingly.

## Contact
Any questions and inquiries (i.e additional research materials, datasheets) can be directed to : best.ubc@gmail.com 
